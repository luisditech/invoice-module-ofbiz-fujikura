<?xml version="1.0" encoding="UTF-8"?>
<forms xmlns:xsi="http://www.w3.org/2001/XMLSchema-instance"
       xmlns="http://ofbiz.apache.org/Widget-Form"
       xsi:schemaLocation="http://ofbiz.apache.org/Widget-Form http://ofbiz.apache.org/dtds/widget-form.xsd">

    <!-- ========================= -->
    <!-- Filtro de búsqueda (single) -->
    <!-- ========================= -->
    <form name="FindInvoicesForm"
          type="single"
          header-row-style="header-row-single"
          default-table-style="basic-table"
          target="findInvoices">

        <!-- Necesario para performFind -->
        <field name="entityName"><hidden value="FinInvoice"/></field>
        <field name="noConditionFind"><hidden value="Y"/></field>
        <!-- Importante para tu prepareFind custom: fuerza el componente -->
        <field name="componentName"><hidden value="invoice"/></field>

        <!-- Filtros -->
        <field name="invSupplierVatNumber" title="Supplier VAT"><text-find/></field>
        <field name="invSupplierName" title="Supplier Name"><text-find/></field>
        <field name="invSupplierCode" title="Supplier Code"><text-find/></field>
        <field name="invInvoiceNumber" title="Invoice No."><text-find/></field>

        <field name="invInvoiceDateFrom" title="Invoice Date From"><date-find type="date"/></field>
        <field name="invInvoiceDateTo" title="Invoice Date To"><date-find type="date"/></field>

        <field name="invValueDateFrom" title="Value Date From"><date-find type="date"/></field>
        <field name="invValueDateTo" title="Value Date To"><date-find type="date"/></field>

        <field name="invPaymentDueDateFrom" title="Payment Due Date From"><date-find type="date"/></field>
        <field name="invPaymentDueDateTo" title="Payment Due Date To"><date-find type="date"/></field>

        <field name="invTaxType" title="Tax Type"><text-find/></field>
        <field name="invTaxRate" title="Tax Rate"><text-find/></field>
        <field name="invCurrency" title="Currency"><text-find/></field>
        <field name="invPaymentMethod" title="Payment Method"><text-find/></field>

        <field name="invNetAmountFrom" title="Net Amount From"><text-find/></field>
        <field name="invNetAmountTo" title="Net Amount To"><text-find/></field>

        <field name="invConfirmed" title="Confirmed">
            <drop-down allow-empty="true">
                <option key="Y" description="${uiLabelMap.CommonYes}"/>
                <option key="N" description="${uiLabelMap.CommonNo}"/>
            </drop-down>
        </field>

        <field name="invPaymentDone" title="Payment Done">
            <drop-down allow-empty="true">
                <option key="Y" description="${uiLabelMap.CommonYes}"/>
                <option key="N" description="${uiLabelMap.CommonNo}"/>
            </drop-down>
        </field>

        <!-- Acciones -->
        <field name="submitButton" title="${uiLabelMap.CommonFind}" widget-style="smallSubmit"><submit/></field>
        <field name="clearButton" title=" " widget-style="smallSubmit">
            <hyperlink target="findInvoices" description="${uiLabelMap.CommonClear}"/>
        </field>
    </form>

    <!-- ======================= -->
    <!-- Lista (usa performFind) -->
    <!-- ======================= -->
    <form name="ListInvoicesForm" type="list" list-name="entityList"
          paginate-target="findInvoices"
          odd-row-style="alt-row" even-row-style="row-style"
          header-row-style="header-row-2" default-table-style="basic-table">

        <actions>
            <!-- Permitir listar sin filtros -->
            <set field="parameters.noConditionFind" value="Y"/>
            <!-- Pasar el componente a prepareFind (si tu lógica lo usa) -->
            <set field="parameters.componentName" value="invoice"/>
            <!-- Orden por defecto -->
            <set field="parameters.sortField" from-field="parameters.sortField" default-value="invoiceId"/>

            <!-- Llamada a performFind (con userLogin para evitar entityCondition cuando seas admin) -->
            <service service-name="performFind" result-map="findRes">
                <field-map field-name="entityName" value="FinInvoice"/>
                <field-map field-name="inputFields" from-field="parameters"/>
                <field-map field-name="orderBy" from-field="parameters.sortField"/>
                <field-map field-name="viewIndex" from-field="viewIndex"/>
                <field-map field-name="viewSize" from-field="viewSize"/>
                <field-map field-name="noConditionFind" value="Y"/>
                <field-map field-name="userLogin" from-field="userLogin"/>
            </service>

            <set field="entityList" from-field="findRes.listIt"/>
        </actions>

        <!-- Columnas ordenables -->
        <field name="invoiceId" title="${uiLabelMap.InvoiceInvoiceId}" sort-field="true">
            <hyperlink target="viewInvoiceDetail" description="${invoiceId}">
                <parameter param-name="invoiceId" from-field="invoiceId"/>
            </hyperlink>
        </field>

        <field name="invSupplierCode" title="${uiLabelMap.InvoiceSupplierCode}" sort-field="true"><display/></field>
        <field name="invSupplierName" title="${uiLabelMap.InvoiceSupplierName}" sort-field="true"><display/></field>
        <field name="invSupplierVatNumber" title="${uiLabelMap.InvoiceSupplierVatNumber}" sort-field="true"><display/></field>
        <field name="invInvoiceNumber" title="${uiLabelMap.InvoiceInvoiceNumber}" sort-field="true"><display/></field>
        <field name="invInvoiceDate" title="${uiLabelMap.InvoiceInvoiceDate}" sort-field="true"><display type="date"/></field>
        <field name="invValueDate" title="${uiLabelMap.InvoiceValueDate}" sort-field="true"><display type="date"/></field>
        <field name="invPaymentDueDate" title="${uiLabelMap.InvoicePaymentDueDate}" sort-field="true"><display type="date"/></field>
        <field name="invTaxType" title="${uiLabelMap.InvoiceTaxType}" sort-field="true"><display/></field>
        <field name="invIva" title="${uiLabelMap.InvoiceTaxRate}" sort-field="true"><display/></field>
        <field name="invNetAmount" title="${uiLabelMap.InvoiceNetAmount}" sort-field="true"><display type="currency"/></field>
        <field name="invTotalVatAmount" title="${uiLabelMap.InvoiceTotalVatAmount}" sort-field="true"><display type="currency"/></field>
        <field name="invTotalAmountWithVat" title="${uiLabelMap.InvoiceTotalAmountWithVat}" sort-field="true"><display type="currency"/></field>
        <field name="invCurrency" title="${uiLabelMap.InvoiceCurrency}" sort-field="true"><display/></field>
        <field name="invAccountingCurrency" title="${uiLabelMap.InvoiceAccountingCurrency}" sort-field="true"><display/></field>
        <field name="invExchangeRate" title="${uiLabelMap.InvoiceCurrencyExchange}" sort-field="true"><display/></field>
        <field name="invPaymentMethod" title="${uiLabelMap.InvoicePaymentMethod}" sort-field="true"><display/></field>
        <field name="invPaymentDone" title="${uiLabelMap.InvoicePaymentDone}" sort-field="true"><display/></field>
        <field name="invConfirmed" title="${uiLabelMap.InvoiceConfirmed}" sort-field="true"><display/></field>

        <field name="view" title=" ">
            <hyperlink target="viewInvoiceDetail" description="${uiLabelMap.CommonView}">
                <parameter param-name="invoiceId" from-field="invoiceId"/>
            </hyperlink>
        </field>
    </form>

    <!-- ============================================= -->
    <!-- Lista completa -->
    <!-- ============================================= -->
    <form name="ListInvoicesFormFull" type="list" list-name="entityList"
          paginate-target="findInvoices"
          odd-row-style="alt-row" even-row-style="row-style"
          header-row-style="header-row-2" default-table-style="basic-table">

        <actions>
            <set field="noConditionFind" value="Y"/>
            <set field="parameters.noConditionFind" value="Y"/>
            <set field="parameters.componentName" value="invoice"/>
            <set field="parameters.sortField" from-field="parameters.sortField" default-value="invoiceId"/>
            <set field="entityName" value="FinInvoice"/>
            <set field="parameters.entityName" value="FinInvoice"/>

            <service service-name="performFind" result-map="result" result-map-list="entityList">
                <field-map field-name="inputFields" from-field="parameters"/>
                <field-map field-name="entityName" value="FinInvoice"/>
                <field-map field-name="orderBy" from-field="parameters.sortField"/>
                <field-map field-name="viewIndex" from-field="viewIndex"/>
                <field-map field-name="viewSize" from-field="viewSize"/>
                <field-map field-name="noConditionFind" value="Y"/>
                <field-map field-name="userLogin" from-field="userLogin"/>
            </service>

            <set field="entityList" from-field="result.listIt"/>
        </actions>

        <!-- mismas columnas que la lista anterior -->
        <field name="invoiceId" title="${uiLabelMap.InvoiceInvoiceId}" sort-field="true"><display/></field>
        <field name="invSupplierCode" title="${uiLabelMap.InvoiceSupplierCode}" sort-field="true"><display/></field>
        <field name="invSupplierName" title="${uiLabelMap.InvoiceSupplierName}" sort-field="true"><display/></field>
        <field name="invSupplierVatNumber" title="${uiLabelMap.InvoiceSupplierVatNumber}" sort-field="true"><display/></field>
        <field name="invInvoiceNumber" title="${uiLabelMap.InvoiceInvoiceNumber}" sort-field="true"><display/></field>
        <field name="invInvoiceDate" title="${uiLabelMap.InvoiceInvoiceDate}" sort-field="true"><display type="date"/></field>
        <field name="invValueDate" title="${uiLabelMap.InvoiceValueDate}" sort-field="true"><display type="date"/></field>
        <field name="invPaymentDueDate" title="${uiLabelMap.InvoicePaymentDueDate}" sort-field="true"><display type="date"/></field>
        <field name="invTaxType" title="${uiLabelMap.InvoiceTaxType}" sort-field="true"><display/></field>
        <field name="invIva" title="${uiLabelMap.InvoiceTaxRate}" sort-field="true"><display/></field>
        <field name="invNetAmount" title="${uiLabelMap.InvoiceNetAmount}" sort-field="true"><display type="currency"/></field>
        <field name="invTotalVatAmount" title="${uiLabelMap.InvoiceTotalVatAmount}" sort-field="true"><display type="currency"/></field>
        <field name="invTotalAmountWithVat" title="${uiLabelMap.InvoiceTotalAmountWithVat}" sort-field="true"><display type="currency"/></field>
        <field name="invCurrency" title="${uiLabelMap.InvoiceCurrency}" sort-field="true"><display/></field>
        <field name="invAccountingCurrency" title="${uiLabelMap.InvoiceAccountingCurrency}" sort-field="true"><display/></field>
        <field name="invExchangeRate" title="${uiLabelMap.InvoiceCurrencyExchange}" sort-field="true"><display/></field>
        <field name="invPaymentMethod" title="${uiLabelMap.InvoicePaymentMethod}" sort-field="true"><display/></field>
        <field name="invPaymentDone" title="${uiLabelMap.InvoicePaymentDone}" sort-field="true"><display/></field>
        <field name="invConfirmed" title="${uiLabelMap.InvoiceConfirmed}" sort-field="true"><display/></field>

        <field name="view" title="${uiLabelMap.CommonView}">
            <hyperlink target="viewInvoiceDetail" description="${uiLabelMap.CommonView}">
                <parameter param-name="invoiceId" from-field="invoiceId"/>
            </hyperlink>
        </field>
    </form>

    <!-- VIEW INVOICE FORM -->
    <form name="ViewInvoiceForm"
          type="single"
          default-map-name="invoice"
          header-row-style="header-row-single"
          default-table-style="basic-table">

        <!-- Identificación -->
        <field name="invoiceId" title="${uiLabelMap.InvoiceInvoiceId}"><display/></field>
        <field name="invInvoiceNumber" title="${uiLabelMap.InvoiceInvoiceNumber}"><display/></field>

        <!-- Proveedor -->
        <field name="invSupplierCode" title="${uiLabelMap.InvoiceSupplierCode}"><display/></field>
        <field name="invSupplierName" title="${uiLabelMap.InvoiceSupplierName}"><display/></field>
        <field name="invSupplierVatNumber" title="${uiLabelMap.InvoiceSupplierVatNumber}"><display/></field>

        <!-- Fechas -->
        <field name="invInvoiceDate" title="${uiLabelMap.InvoiceInvoiceDate}"><display type="date"/></field>
        <field name="invValueDate" title="${uiLabelMap.InvoiceValueDate}"><display type="date"/></field>
        <field name="invPaymentDueDate" title="${uiLabelMap.InvoicePaymentDueDate}"><display type="date"/></field>

        <!-- Impuestos y totales -->
        <field name="invTaxType" title="${uiLabelMap.InvoiceTaxType}"><display/></field>
        <field name="invIva" title="${uiLabelMap.InvoiceTaxRate}"><display/></field>
        <field name="invNetAmount" title="${uiLabelMap.InvoiceNetAmount}"><display type="currency"/></field>
        <field name="invTotalVatAmount" title="${uiLabelMap.InvoiceTotalVatAmount}"><display type="currency"/></field>
        <field name="invTotalAmountWithVat" title="${uiLabelMap.InvoiceTotalAmountWithVat}"><display type="currency"/></field>

        <!-- Moneda -->
        <field name="invCurrency" title="${uiLabelMap.InvoiceCurrency}"><display/></field>
        <field name="invAccountingCurrency" title="${uiLabelMap.InvoiceAccountingCurrency}"><display/></field>
        <field name="invExchangeRate" title="${uiLabelMap.InvoiceCurrencyExchange}"><display/></field>

        <!-- Pago / estados -->
        <field name="invPaymentMethod" title="${uiLabelMap.InvoicePaymentMethod}"><display/></field>
        <field name="invPaymentDone" title="${uiLabelMap.InvoicePaymentDone}"><display/></field>
        <field name="invConfirmed" title="${uiLabelMap.InvoiceConfirmed}"><display/></field>

    </form>

    <!-- view lines -->
    <form name="ListInvoiceLines"
          type="list"
          list-name="invoiceLines"
          list-entry-name="line"
          default-map-name="line"
          paginate-target="viewInvoiceDetail"
          odd-row-style="alt-row" even-row-style="row-style"
          header-row-style="header-row-2" default-table-style="basic-table">

        <field name="invoiceLineSeqId" title="Line ID"><display/></field>
        <field name="lineName" title="Name"><display/></field>
        <field name="lineArticleCodeBySeller" title="Article code"><display/></field>
        <field name="lineQuantity" title="Quantity"><display/></field>
        <field name="lineMeasurementUnit" title="Measurement Unit"><display/></field>
        <field name="lineUnitPrice" title="Unit Price"><display type="currency"/></field>
        <field name="lineDeliveryNote" title="Delivery Note"><display/></field>
        <field name="lineTaxRate" title="Tax Rate"><display/></field>
        <field name="lineNetAmount" title="Net Amount"><display type="currency"/></field>
        <field name="lineTotalAmountWithVat" title="Total with VAT"><display type="currency"/></field>
        <field name="lineProof" title="Proof"><display/></field>
        <field name="lineCc" title="Cost Center"><display/></field>
        <field name="lineBranch" title="Branch"><display/></field>
        <field name="lineProject" title="Project"><display/></field>
    </form>

    <!-- totales -->
    <form name="InvoiceLinesTotals"
          type="list"
          list-name="totalsList"
          list-entry-name="t"
          default-map-name="t"
          header-row-style="header-row-2"
          default-table-style="basic-table">

        <!-- Etiqueta -->
        <field name="totalsLabel" title=""><display/></field>

        <!-- Total neto -->
        <field name="totalNet" title=""><display type="currency"/></field>

        <!-- Total con IVA -->
        <field name="totalWithVat" title=""><display type="currency"/></field>
    </form>

</forms>
